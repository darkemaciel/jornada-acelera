<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plano de Estudos - Painel Interativo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
</head>
<body class="bg-gray-100 text-gray-900">

  <script>
    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAEO-xyvglvqUZeWhyhavIhjvYtuHG7qNk",
      authDomain: "jornadadedados-estudos.firebaseapp.com",
      projectId: "jornadadedados-estudos",
      storageBucket: "jornadadedados-estudos.firebasestorage.app",
      messagingSenderId: "191468736649",
      appId: "1:191468736649:web:5c4de82d2fd6b220297658",
      measurementId: "G-H7CHJPQR2T"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
  </script>

  <!-- Cabeçalho -->
  <header class="bg-indigo-600 text-white shadow-lg p-6 text-center">
    <h1 class="text-4xl md:text-5xl font-bold mb-2">Plano de Estudo</h1>
    <p class="text-xl md:text-2xl">Jornada de 3 Meses para Engenharia de Dados e IA</p>
  </header>

  <!-- Autenticação -->
  <section id="authSection" class="bg-white p-4 shadow-md rounded-lg m-4 text-center">
    <h2 class="text-xl font-semibold mb-2">Acesso</h2>
    
    <!-- Login -->
    <div id="loginForm">
      <input type="email" id="email" placeholder="Email" class="border p-2 rounded w-64 mb-2">
      <input type="password" id="password" placeholder="Senha" class="border p-2 rounded w-64 mb-2">
      <div class="flex justify-center gap-2">
        <button onclick="signUp()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Cadastrar</button>
        <button onclick="signIn()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Entrar</button>
      </div>
    </div>

    <!-- Logout -->
    <div id="logoutSection" class="hidden">
      <p id="userEmail" class="mb-2 text-gray-700"></p>
      <button onclick="signOutUser()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Sair</button>
    </div>
  </section>

  <!-- Conteúdo principal -->
  <main class="container mx-auto p-4 md:p-8">

    <section id="overview" class="bg-white p-6 rounded-lg shadow-lg mb-8">
      <h2 class="text-3xl font-semibold text-gray-800 mb-6 border-b-2 border-indigo-200 pb-2">Visão Geral do Plano</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-indigo-100 p-6 rounded-lg shadow-md text-center">
          <p class="text-lg font-medium text-indigo-700">Total de Horas</p>
          <p id="totalHours" class="text-4xl font-bold text-indigo-900 mt-1">...</p>
        </div>
        <div class="bg-indigo-100 p-6 rounded-lg shadow-md text-center">
          <p class="text-lg font-medium text-indigo-700">Total de Módulos</p>
          <p id="totalModules" class="text-4xl font-bold text-indigo-900 mt-1">...</p>
        </div>
        <div class="bg-indigo-100 p-6 rounded-lg shadow-md text-center">
          <p class="text-lg font-medium text-indigo-700">Total de Trilhas</p>
          <p id="totalTracks" class="text-4xl font-bold text-indigo-900 mt-1">...</p>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
        <div class="bg-gray-50 p-6 rounded-lg shadow-md">
          <h3 class="text-xl font-semibold mb-3">Progresso</h3>
          <div class="w-full bg-gray-300 rounded-full h-8 overflow-hidden">
            <div id="progressBar" class="bg-indigo-500 h-8 text-white text-center text-sm font-bold leading-8 progress-bar" style="width: 0%;">
              <span id="progressText">0% Concluído</span>
            </div>
          </div>
        </div>
        <div class="bg-gray-50 p-6 rounded-lg shadow-md flex flex-col justify-center items-center">
          <h3 class="text-xl font-semibold text-center mb-3">Horas por Trilha</h3>
          <div class="w-full max-w-xs">
            <canvas id="trackChart" style="max-height: 300px;"></canvas>
          </div>
        </div>
      </div>
    </section>

    <section id="detailed-plan" class="bg-white p-6 rounded-lg shadow-lg">
      <h2 class="text-3xl font-semibold text-gray-800 mb-6 border-b-2 border-indigo-200 pb-2">Plano Detalhado</h2>

      <div id="filterButtons" class="flex flex-wrap gap-2 mb-6">
        <button onclick="filterTable('all')" class="px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition">Todos os Módulos</button>
      </div>

      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 shadow-md rounded-lg overflow-hidden">
          <thead class="bg-indigo-500 text-white">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Concluído</th>
              <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Trilha</th>
              <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Módulo</th>
              <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Carga Horária (h)</th>
              <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Dias Necessários</th>
              <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Objetivo</th>
            </tr>
          </thead>
          <tbody id="dataTableBody" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="notification" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-gray-800 text-white py-2 px-4 rounded-full shadow-lg opacity-0 notification pointer-events-none">
    Conteúdo atualizado!
  </div>

  <script>
    let myChart;
    let originalData = [];
    let completedModules = {};

    // Funções de autenticação
    async function signUp() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        await auth.createUserWithEmailAndPassword(email, password);
      } catch (error) {
        alert("Erro ao cadastrar: " + error.message);
      }
    }

    async function signIn() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        await auth.signInWithEmailAndPassword(email, password);
      } catch (error) {
        alert("Erro ao entrar: " + error.message);
      }
    }

    function signOutUser() {
      auth.signOut();
    }

    // Salvar progresso
    async function saveProgress() {
      if (!auth.currentUser) return;
      try {
        await db.collection('progress').doc(auth.currentUser.uid).set({
          completed: completedModules,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        showNotification();
      } catch (error) {
        console.error("Erro ao salvar progresso:", error);
      }
    }

    function showNotification() {
      const el = document.getElementById('notification');
      el.style.opacity = '1';
      setTimeout(() => el.style.opacity = '0', 3000);
    }

    function updateStats() {
      const totalModules = originalData.length;
      const completedCount = Object.values(completedModules).filter(Boolean).length;
      const progressPercentage = (completedCount / totalModules) * 100;
      document.getElementById('totalModules').innerText = totalModules;
      document.getElementById('progressText').innerText = `${progressPercentage.toFixed(0)}% Concluído`;
      document.getElementById('progressBar').style.width = `${progressPercentage}%`;
    }

    function updateChart() {
      const trackHours = {};
      originalData.forEach(item => {
        const track = item['Trilha'];
        const hours = parseFloat(item['Carga Horária (h)']);
        if (!isNaN(hours)) {
          trackHours[track] = (trackHours[track] || 0) + hours;
        }
      });

      const labels = Object.keys(trackHours);
      const data = Object.values(trackHours);

      const totalHours = data.reduce((sum, h) => sum + h, 0);
      document.getElementById('totalHours').innerText = `${totalHours.toFixed(1)}`;
      document.getElementById('totalTracks').innerText = labels.length;

      const chartData = {
        labels: labels,
        datasets: [{
          label: 'Horas',
          data: data,
          backgroundColor: [
            'rgba(79, 70, 229, 0.8)',
            'rgba(239, 68, 68, 0.8)',
            'rgba(34, 197, 94, 0.8)',
            'rgba(251, 191, 36, 0.8)',
            'rgba(59, 130, 246, 0.8)'
          ],
          borderColor: [
            'rgba(79, 70, 229, 1)',
            'rgba(239, 68, 68, 1)',
            'rgba(34, 197, 94, 1)',
            'rgba(251, 191, 36, 1)',
            'rgba(59, 130, 246, 1)'
          ],
          borderWidth: 1
        }]
      };

      const ctx = document.getElementById('trackChart').getContext('2d');
      if (myChart) myChart.destroy();
      myChart = new Chart(ctx, {
        type: 'doughnut',
        data: chartData,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          layout: {
            padding: 10
          },
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                boxWidth: 8
              }
            }
          }
        }
      });
    }

    function renderTable(dataToDisplay) {
      const tableBody = document.getElementById('dataTableBody');
      tableBody.innerHTML = '';
      dataToDisplay.forEach((item, index) => {
        const isCompleted = completedModules[index] || false;
        const row = document.createElement('tr');
        row.className = `border-b hover:bg-gray-100 ${isCompleted ? 'bg-green-50' : ''}`;
        row.innerHTML = `
          <td class="px-6 py-4 text-center">
            <input type="checkbox" data-index="${index}" ${isCompleted ? 'checked' : ''}>
          </td>
          <td class="px-6 py-4">${item['Trilha']}</td>
          <td class="px-6 py-4 font-medium">${item['Módulo']}</td>
          <td class="px-6 py-4">${item['Carga Horária (h)']}</td>
          <td class="px-6 py-4">${item['Dias Necessários']}</td>
          <td class="px-6 py-4">${item['Objetivo']}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    function filterTable(track) {
      let filteredData = originalData;
      if (track !== 'all') filteredData = originalData.filter(item => item['Trilha'] === track);
      renderTable(filteredData);
    }

    function generateFilterButtons() {
      const tracks = [...new Set(originalData.map(item => item['Trilha']))];
      const filterButtonsContainer = document.getElementById('filterButtons');

      // 🔥 Limpa botões anteriores antes de recriar
      filterButtonsContainer.innerHTML = '';

      // Botão "Todos os Módulos"
      const allButton = document.createElement('button');
      allButton.innerText = "Todos os Módulos";
      allButton.onclick = () => filterTable('all');
      allButton.className = "px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition";
      filterButtonsContainer.appendChild(allButton);

      // Botões de cada trilha
      tracks.forEach(track => {
        const button = document.createElement('button');
        button.innerText = track;
        button.onclick = () => filterTable(track);
        button.className = "px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition";
        filterButtonsContainer.appendChild(button);
      });
    }

    async function init() {
      const csvDataString = `Trilha,Módulo,Carga Horária (h),Dias Necessários,Objetivo
Trilha de SQL e dbt-core,Instalação e Setup,2.0,1,Preparar ambiente para consultas SQL e dbt
Trilha de SQL e dbt-core,"Comandos de consulta Select, Where, GroupBy",2.0,1,Criar consultas e sumarizar dados
Trilha de SQL e dbt-core,Joins,2.0,1,Relacionar tabelas em consultas
Trilha de SQL e dbt-core,Window Function,2.0,1,Criar análises avançadas em SQL
Trilha de SQL e dbt-core,Projeto Completo,2.0,1,Consolidar fundamentos em um case real
Trilha de SQL e dbt-core,"CTE, Subqueries, Views, Temporary Tables e Materialized Views",2.0,1,Organizar queries complexas
Trilha de SQL e dbt-core,Criação de tabelas,2.0,1,Definir modelos relacionais em SQL
Trilha de SQL e dbt-core,Stored Procedured,2.0,1,Programar lógica dentro do banco
Trilha de SQL e dbt-core,Triggers e Functions,2.0,1,Programar lógica dentro do banco
Trilha de SQL e dbt-core,Transações ACID,2.0,1,Garantir consistência e segurança em operações no banco
Trilha de SQL e dbt-core,Perfomance e Tuning em SQL,2.0,1,Otimizar consultas e bancos grandes
Trilha de SQL e dbt-core,B-Tree e Index,2.0,1,Otimizar consultas e buscas em tabelas grandes
Trilha de SQL e dbt-core,Particionamento,2.0,1,Melhorar performance de queries em bases extensas
Trilha de SQL e dbt-core,dbt cloud parte 1,2.0,1,Criar pipelines de transformação de dados com dbt
Trilha de SQL e dbt-core,dbt cloud parte 2,2.0,1,Criar pipelines de transformação de dados com dbt
Trilha de SQL e dbt-core,dbt core overview,2.0,1,Compreender os fundamentos do dbt core
Trilha de SQL e dbt-core,ccriando nosso projeto,2.0,1,Configurar e iniciar um projeto dbt
Trilha de SQL e dbt-core,dbt core testes,2.0,1,Aplicar testes em pipelines dbt
Trilha de SQL e dbt-core,dbt core deplot,2.0,1,Publicar projetos dbt em ambiente produtivo
Trilha de SQL e dbt-core,"bigquery, macro e snapshots",2.0,1,Aplicar dbt em ambientes cloud modernos
Trilha de Python,"Python, Git e VScode: Python do Zero",2.0,1,Instalar ambiente e aprender a programar em Python desde o básico
Trilha de Python,"TypeError, Type Check, Type Conversion, try-except e if",2.0,1,Tratar erros e entender como o Python lida com tipos de dados
Trilha de Python,"Controle de Fluxo: DEBUG, IF, FOR, While, Listas e Dicionários",2.0,1,Dominar as estruturas básicas de controle e coleções
Trilha de Python,Tipos complexos e Type Hint (Dicionários vs DataFrames Vs Tabelas Vs Excel),2.0,1,Diferenciar estruturas de dados e aplicar tipagem para organizar código
Trilha de Python,"Projeto 01: Leitura e Escrita de Arquivos, lendo 1 bilhão de linhas",2.0,1,Trabalhar com grandes volumes de dados em Python
Trilha de Python,Exercício de revisão,2.0,1,Consolidar fundamentos de Python com prática aplicada
Trilha de Python,Funções em Python e Estrutura de Dados - Parte 1,2.0,1,Aprender a criar funções reutilizáveis e manipular dados de forma eficiente
Trilha de Python,Funções em Python e Estrutura de Dados - Parte 2,2.0,1,Aprender a criar funções reutilizáveis e manipular dados de forma eficiente
Trilha de Python,Funções em Python e Estrutura de Dados - Parte 3,2.0,1,Aprender a criar funções reutilizáveis e manipular dados de forma eficiente
Trilha de Python,Aula de revisão,2.0,1,Reforçar conceitos e resolver dúvidas de funções e estruturas
Trilha de Python,Introdução a POO,2.0,1,Compreender os conceitos iniciais da Programação Orientada a Objetos
Trilha de Python,Introdução às Classes em Python - Parte 01,2.0,1,"Implementar classes, métodos e herança em Python"
Trilha de Python,Introdução às Classes em Python - Parte 02,2.0,1,"Implementar classes, métodos e herança em Python"
Trilha de Python,Introdução às Classes em Python - Parte 03,2.0,1,"Implementar classes, métodos e herança em Python"
Trilha de Python,Introdução às Classes em Python - Parte 04,2.0,1,"Implementar classes, métodos e herança em Python"
Trilha de Python,Aula de revisão de programação orientada a objetos + SQLModel,2.0,1,Revisar POO aplicando em bancos de dados com SQLModel
Trilha de Python,SQLAlchemy - Conjunto de ferramentas para manipular SQL em Python,2.0,1,Usar ORM para manipular SQL diretamente no Python
Trilha de Python,"O que é uma API? Request, Pydantic e fazendo nosso CRUD",2.0,1,Criar APIs do zero e integrar com banco de dados
Trilha de Python,O que é uma API? Criando nossa primeira API,2.0,1,Criar APIs do zero e integrar com banco de dados
Trilha de Python,Nosso Projeto de CRUD Backend + Frontend + Banco de Dados,2.0,1,"Entregar um projeto completo conectando API, frontend e banco"
Trilha de Engenharia de Dados + IA,"Infra, Linux e Docker",4.0,2,Montar base de infraestrutura para engenharia de dados
Trilha de Engenharia de Dados + IA,Airflow Workflow Orchestration,4.0,2,Orquestrar pipelines de dados com Airflow
Trilha de Engenharia de Dados + IA,Data Pipelines com Airflow 3.0 + dbt com Astro,4.0,2,Construir pipelines modernas com ferramentas integradas
Trilha de Engenharia de Dados + IA,"Web Scraping, Redis, MongoDB e noSQL",4.0,2,Extrair e manipular dados em escala com diferentes bancos
Trilha de Engenharia de Dados + IA,"Agentes de IA com Agno, CrewIA e Langchain",4.0,2,Criar agentes de IA avançados integrados a dados
Trilha de Engenharia de Dados + IA,Extração de dados em PDF e Regex,4.0,2,Ler e transformar dados complexos de documentos
Trilha de Engenharia de Dados + IA,Event-Driven com Amazon SQS e Lambda AWS,4.0,2,Criar pipelines orientados a eventos
Trilha de Engenharia de Dados + IA,Arquitetura Streaming com Kafka,4.0,2,Processar dados em tempo real
Trilha de Engenharia de Dados + IA,"Observabilidade com Prothes, Sentry e OpenTelemetry",4.0,2,"Monitorar pipelines com Prometheus, Sentry e OpenTelemetry"
Trilha de Engenharia de Dados + IA,Infra as Code com Terraform,4.0,2,Criar infraestrutura escalável e versionada
Trilha de Engenharia de Dados + IA,Design Sprint para especificação de projetos,4.0,2,Aprender a especificar projetos de dados de ponta a ponta
Trilha de Engenharia de Dados + IA,DevOps e Kubernetes para Dados,4.0,2,Aplicar práticas de DevOps em ambientes de dados
`; // <-- use seu CSV completo aqui

      function parseCSV(csv) {
        const lines = csv.split('\n').filter(line => line.trim() !== '');
        const headers = lines[0].split(',');
        const data = [];
        for (let i = 1; i < lines.length; i++) {
          const values = lines[i].split(',');
          if (values.length === headers.length) {
            const row = {};
            headers.forEach((h, idx) => row[h] = values[idx]);
            data.push(row);
          }
        }
        return data;
      }

      originalData = parseCSV(csvDataString);

      auth.onAuthStateChanged(async (user) => {
        if (user) {
          document.getElementById("loginForm").classList.add("hidden");
          document.getElementById("logoutSection").classList.remove("hidden");
          document.getElementById("userEmail").innerText = user.email ? `Logado como: ${user.email}` : "Logado anonimamente";

          const doc = await db.collection('progress').doc(user.uid).get();
          if (doc.exists) {
            completedModules = doc.data().completed || {};
          }
        } else {
          document.getElementById("loginForm").classList.remove("hidden");
          document.getElementById("logoutSection").classList.add("hidden");
          completedModules = {};
        }

        updateChart();
        generateFilterButtons();
        renderTable(originalData);
        updateStats();
      });

      document.getElementById('dataTableBody').addEventListener('change', (e) => {
        if (e.target.matches('input[type="checkbox"]')) {
          const index = e.target.getAttribute('data-index');
          completedModules[index] = e.target.checked;
          updateStats();
          saveProgress();
        }
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
